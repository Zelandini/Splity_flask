{% extends 'base.html' %}

{% block title %}{{ group.name }}{% endblock %}

{% block content %}
<div class="container">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{ category }}">
            {{ message }}
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h1>{{ group.name }}</h1>
    <p><strong>Description:</strong> {{ group.description }}</p>
    <p><strong>Currency:</strong> {{ group.currency }}</p>
    <p><strong>Invite Code:</strong> <code style="font-size: 1.2em; background-color: #f0f0f0; padding: 5px;">{{ group.invite_code }}</code></p>
    {% if current_user.id == group.creator_id %}
    <a href="{{ url_for('home.edit_group', group_id=group.id) }}" class="btn btn-secondary">Edit Group</a>
    {% else %}
    <a href="" class="btn btn-secondary">Edit Group</a>
    <span>(Only creator can edit)</span>
    {% endif %}
    <hr>

    <h3>Group Members ({{ members|length }})</h3>
    {% if members %}
        <ul>
        {% for member in members %}
            <li>
                {{ member.name }} (@{{ member.username }})
                {% if member.id == group.creator_id %}
                    <span style="color: green;">[Creator]</span>
                {% endif %}
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No members in this group yet.</p>
    {% endif %}

    <hr>

    <h3>Bills</h3>
    {% if bill_data %}
        <ul style="list-style-type: none; padding: 0;">
        {% for bill, creator in bill_data %}
            <li style="margin-bottom: 15px; padding: 10px; border: 1px solid #ddd; border-radius: 5px;">
                <strong>{{ bill.description }}</strong><br>
                <small>{{ bill.amount }} {{ group.currency }}</small><br>
                <small>
                    Created at: {{ bill.date }} |
                    by: {{ creator.name }} (@{{ creator.username }})
                </small><br>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No bills added yet!</p>
    {% endif %}

    <hr>

    <div class="actions">
        <a href="{{ url_for('home.home') }}" class="btn btn-secondary">Back to Home</a>

        {% if current_user.id == group.creator_id %}
            <a href="{{ url_for('home.delete_group', group_id=group.id, user_id=current_user.id) }}" class="btn btn-secondary">Delete Group</a>
        {% else %}
            <a href="{{ url_for('home.leave_group', group_id=group.id, user_id=current_user.id) }}" class="btn btn-secondary">Leave Group</a>
        {% endif %}
        <a href="{{ url_for('bills.create_bill', group_id=group.id) }}" class="btn btn-secondary">Add bill</a>
    </div>
</div>
{% endblock %}