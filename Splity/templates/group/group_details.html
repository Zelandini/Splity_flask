{% extends 'base.html' %}

{% block title %}Splity - {{ group.name }}{% endblock %}

{% block content %}
    <h1>{{ group.name }}</h1>
    <div style="margin-bottom: 2rem;">
        <p><strong>DESCRIPTION:</strong> {{ group.description }}</p>
        <p><strong>CURRENCY:</strong> {{ group.currency }}</p>
        <p><strong>INVITE CODE:</strong> <code>{{ group.invite_code }}</code></p>
    </div>

    <div style="display: flex; gap: 10px; margin-bottom: 2rem;">
        <a href="{{ url_for('bills.create_bill', group_id=group.id) }}" class="btn btn-primary">Add New Bill</a>
        {% if current_user.id == group.creator_id %}
            <a href="{{ url_for('home.edit_group', group_id=group.id) }}" class="btn btn-secondary">Edit Group Settings</a>
        {% endif %}
    </div>

    <div style="background: var(--light-blue); padding: 2rem; border: 2px solid var(--primary-blue); margin-bottom: 3rem;">
        <h3 style="color: var(--dark-blue); margin-top: 0;">Financial Standing</h3>
        <p>Total Group Spend: <strong>{{ total_group_spending }} {{ group.currency }}</strong></p>
        <p>Your Net Balance:
            <span style="color: {% if user_net_balance < 0 %}#d00{% else %}#007a33{% endif %}; font-weight: 800;">
                {{ user_net_balance }} {{ group.currency }}
            </span>
        </p>
    </div>

    <h2>Settle Up Transactions</h2>
    {% if settle_payments %}
        <ul>
        {% for s in settle_payments %}
            <li>
                <div style="display: flex; justify-content: space-between; align-items: center;">
                    <span><strong>{{ s[0] }}</strong> pays {{ s[1] }} {{ group.currency }} to <strong>{{ s[2] }}</strong></span>
                </div>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No transactions needed. Everyone is even!</p>
    {% endif %}

    <h2>Bill History</h2>
    {% if bill_data %}
        <ul>
        {% for bill, creator in bill_data %}
            <li>
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                    <div>
                        <strong>{{ bill.description }}</strong>
                        <p style="margin: 5px 0; color: var(--text-muted); font-size: 0.9rem;">
                            Amount: {{ bill.amount }} {{ group.currency }} | Paid by: {{ creator.name }}
                        </p>
                    </div>
                    {% if current_user.id == creator.id or current_user.id == group.creator_id %}
                        <a href="{{ url_for('bills.delete_bill', bill_id=bill.id, group_id=group.id) }}" class="btn" style="background: #f8d7da; color: #721c24; border-color: #721c24; padding: 5px 10px; font-size: 0.7rem;">Delete</a>
                    {% endif %}
                </div>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No bills recorded yet.</p>
    {% endif %}

    <div style="margin-top: 3rem; padding-top: 1rem; border-top: 2px solid #ddd;">
        <a href="{{ url_for('home.home') }}" class="btn btn-secondary">‚Üê Back to Dashboard</a>
    </div>
{% endblock %}